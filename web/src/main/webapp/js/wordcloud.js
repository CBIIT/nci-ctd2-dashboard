const subject_frequency =
    `
navitoclax 1748
invasive breast carcinoma 1680
selumetinib 1404
lung adenocarcinoma 1369
lung 1199
Kras 1094
colon adenocarcinoma 1066
gastric adenocarcinoma 976
large intestine 838
piperlongumine 822
carboplatin 806
JQ-1 643
uterine corpus endometrioid ad 632
decitabine 632
vemurafenib 600
colorectal adenocarcinoma 583
vorinostat 536
LY-2183240 531
NCIH1299 460
tretinoin 456
MCF10A 431
EGFR 428
nutlin-3 418
FQI-1 407
lung carcinoma 406
UNC0638 402
TP53 399
parbendazole 397
thyroid carcinoma 390
isoevodiamine 386
indisulam 382
zebularine 379
CTNNB1 375
neuroglial tumor 357
PIK3CA 353
BIX-01294 350
bladder urothelial carcinoma 326
serdemetan 322
BRD-A02303741 320
etoposide 318
glioblastoma 317
BRAF 314
head and neck squamous cell ca 311
clear cell renal cell carcinom 307
PNU-74654 299
Merck60 293
YAP1 290
BMS-536924 279
PX-12 274
papillary renal cell carcinoma 271
CDKN2A 264
crizotinib 260
prostate adenocarcinoma 242
cervical carcinoma 236
GDC-0941 230
MK-2206 227
MAPK1 226
RITA 223
MYC 221
epithelial tissue 214
tipifarnib-P2 214
AKT1 208
NSC632839 206
MAPK3 204
PIK3R1 203
chaetocin 199
cytochalasin B 196
fedratinib 193
CHIR-99021 190
erlotinib 187
CACCTGTAATCCCAGCACTTT 187
tanespimycin 185
CACACCTGTAATCCCAGCATT 185
parthenolide 184
STK11 184
bortezomib 179
GRB2 178
BRD9876 174
Hras 173
birinapant 171
kinetin riboside 168
pluripotin 166
NUP210 164
neopeltolide 162
sorafenib 162
hepatocellular carcinoma 160
breast 160
SRC 158
CD-437 157
Neuronal Differentiation Induc 156
NSC48300 155
ciclosporin 154
olaparib 154
NPC-26 152
MST-312 152
chlorambucil 152
HCTtetK 150
austocystin D 149
MAPK14 148
BMS-195614 147
ML214 146
PDMP 144
KU-0063794 143
NTRK3 143
entinostat 142
mitomycin 142
ABT-737 141
cytarabine 141
doxorubicin 140
MK-0752 139
TPCA-1 137
BRD-K66532283 135
barasertib 135
saracatinib 135
NVP-231 134
PF-184 134
elocalcitol 133
CCT036477 132
oxaliplatin 132
MGCD-265 130
tipifarnib-P1 130
apicidin 130
KU-60019 130
pemetrexed 130
BRD-K61166597 129
NSC95397 128
GSK525762A 127
tosedostat 127
ML006 126
fluorouracil 125
CDK1 125
NUP37 125
BRD-K85133207 124
quinoclamine 124
BRD-K88742110 124
fingolimod 124
itraconazole 123
Compound 23 citrate 123
KW-2449 123
brivanib 122
AT7867 122
MAP2K1 122
salermide 120
necrostatin-1 120
NRAS 120
pazopanib 119
dexamethasone 119
PAC-1 118
PD318088 118
avrainvillamide 117
CREBBP 117
Ba/F3 116
SCH-529074 116
ruxolitinib 116
T-5345967 115
alisertib 114
ATR 114
ORC4 114
SOS1 114
AGK-2 113
PIK-93 113
GSK-3 inhibitor IX 112
valdecoxib 112
CCNE1 112
L-685458 111
azacitidine 111
adavosertib 110
BRD1812 109
IL1A 109
hematopoietic and lymphoid tis 108
imatinib 108
BRD-K63431240 108
Compound 7d-cis 107
chordoma 106
Mdivi-1 106
cisplatin 106
AZD7762 105
ATM 105
PRKCB 105
RAF1 105
UBA52 105
CCNA1 105
Compound 1541A 104
SHC1 104
ML320 103
cabozantinib 103
sirolimus 102
EP300 102
dacarbazine 101
nintedanib 101
linsitinib 101
VER-155008 100
epigallocatechin-3-monogallate 100
PRKCA 99
PTEN 99
cutaneous melanoma 98
BMS-754807 98
SGX-523 98
BRD-K41597374 98
NFKB1 98
RELA 98
sotrastaurin 97
BRD-K92856060 97
    1,9-pyrazoloanthrone 97
JW-480 97
GW-843682X 96
dactolisib 96
BRD-K13999467 96
voxtalisib analogue 95
ciclopirox 95
tacrolimus 95
AC55649 94
BRD-K34222889 94
WP1130 94
CHEK1 94
BRD-A71883111 93
BRD6340 93
ZSTK474 93
vandetanib 92
SRT-1720 92
MLN-4924 91
GNB1 91
AA-COCF3 90
gossypol 90
BRD6368 90
IL6 90
NVP-TAE684 89
tamoxifen 89
afatinib 89
BRD9647 89
PHA-793887 89
CAL-101 89
BRD-K24690302 89
ML239 89
FYN 89
RAC1 89
simvastatin 88
LE-135 87
BRD1835 87
teniposide 87
CDK2 87
I-BET151 86
BRD7137 86
ERBB2 86
GSK3B 86
NCBP2 86
CI976 85
AZD7545 85
NSC30930 85
sepantronium bromide 85
SR-II-138A 84
semagacestat 84
masitinib 84
momelotinib 84
PYR-41 84
lomeguatrib 84
COL-3 84
tivozanib 83
B02 82
BRD-K80183349 82
PRKACB 82
ML258 81
tamatinib 81
OSI-027 81
WAY-362450 81
axitinib 81
PTPN6 81
SKI-II 80
FGFR4 80
MAPK8 80
GDC-0879 79
ML311 79
HC-067047 79
E2F1 79
MET 79
RPS27A 79
pancreatic ductal adenocarcino 78
foretinib 78
HLI 373 78
YL54 78
AM-580 78
Ko-143 77
JAK1 77
MYCN 77
lenvatinib 76
gemcitabine 76
pifithrin-alpha 76
CCNB1 76
JAK2 76
JUN 76
RB1 76
LATS2 76
Ch-55 75
fumonisin B1 75
RG-108 75
BRD-K51490254 74
pifithrin-mu 73
necrostatin-7 73
GNG3 73
neuroblastoma 72
spautin-1 72
BRD-K99006945 72
CAY10594 72
curcumin 72
bleomycin A2 71
PL-DI 70
PLCG1 70
PPP2CA 70
ARID1A 70
acute myeloid leukemia 69
colorectal carcinoma 69
OSI-930 69
SB-225002 69
PRKAR2A 69
AAAS 69
    16-beta-bromoandrosterone 68
BRD-K52037352 68
BRD-K50799972 68
ML050 68
idarubicin 68
prochlorperazine 68
BRD8899 68
CDC25C 68
CDK6 68
PRKAR2B 68
MAP2K3 68
SB-525334 67
gefitinib 67
PRKAR1A 67
AZD6482 66
TG-100-115 66
PF-750 66
CHM-1 66
Ki8751 66
BRD-K29313308 66
CDK4 66
squamous cell lung carcinoma 65
bosutinib 65
UNC0321 65
quizartinib 65
BRD-K02251932 65
TGX-221 65
BRD-K07442505 65
CASP3 65
GNG4 65
HUS1 65
vorapaxar 64
ML029 64
CALM1 64
CBL 64
ORC5 64
PAK1 64
SMARCA4 64
TFDP1 64
STF-31 63
NVP-ADW742 63
IPR-456 63
PLX-4720 63
IKBKB 63
ELCPK 62
belinostat 62
RHOA 62
FGFR1 62
TRAF6 62
AKT3 62
SR1001 61
AZD4547 61
PF-543 61
BIBR1532 61
FGFR2 61
NUP42 61
SN-38 60
MTOR 60
RAD9A 60
BRD4770 59
C6-ceramide 59
GSK2636771 59
FGF2 59
GNAS 59
PDGFRA 59
WEE1 59
small cell carcinoma 58
KU-55933 58
ursolic acid 58
BRD-K19103580 58
KU 0060648 58
BRCA2 58
CDC6 58
ITGB2 58
MAP2K2 58
esophageal carcinoma 57
paclitaxel 57
lapatinib 57
GNB2 57
PDPK1 57
TPR 57
PI-103 56
NSC373980 56
tacedinaline 56
neratinib 56
trifluoperazine 56
BRD-K33199242 56
CDC42 56
GNG7 56
IRAK1 56
PLA2G4A 56
pandacostat 55
NSC74859 55
Repligen 136 55
AT-406 55
BIRB-796 55
YK 4-279 55
AKT2 55
IGF1R 55
ITGB1 55
PTK2 55
uterine corpus cancer 54
malignant ovarian neoplasm 54
JW-74 54
veliparib 54
sonidegib 54
temozolomide 54
BRD-K71781559 54
C3 54
CREB1 54
GNG11 54
NCK1 54
PPP2CB 54
STAT3 54
NSC23766 53
VAF-347 53
STAT5B 53
ovarian serous adenocarcinoma 52
VU0155056 52
betulinic acid 52
BYL-719 52
    4-methylfasudil 52
BCL2 52
PAK2 52
PCNA 52
AXIN1 52
ML083 51
BRD-K02492147 51
canertinib 51
PIK-75 51
BRCA1 51
NF2 51
NOTCH3 51
TRAF2 51
YWHAB 51
ORC3 51
CPSF1 51
NUP54 51
bistramide A 50
Compound 110 50
SB-431542 50
ABL1 50
CD4 50
RPA3 50
NUP153 50
GCCTGTAATCCCAGCACTTTA 50
ibrutinib 49
KH-CB19 49
ML203 49
C5 49
CSK 49
TSC2 49
CHEK2 49
DLL1 49
POLR1D 49
GNB4 49
BRD-K55473186 48
compound 1B 48
CDK7 48
IDH2 48
ORC1 48
PIK3CB 48
RAD17 48
RXRA 48
NUP107 48
GSK4112 47
ARNT 47
EGF 47
EIF4G1 47
ERBB3 47
GNG5 47
STAT6 47
Compound 10b 46
CYT-997 46
triacsin C 46
HMGA1 46
MAPK11 46
RPA2 46
TERT 46
POLD4 46
BRD-K27188169 45
SU11274 45
BRD-K11533227 45
NSC19630 45
bendamustine 45
JAG1 45
CALM2 45
CALM3 45
CALR 45
NFE2L2 45
TRRAP 45
A-804598 44
cerulenin 44
CBB-1007 44
    2,4-dideoxy-DC-45-A2 44
ADK 44
CHUK 44
FGFR3 44
NFX1 44
P2RX7 44
NUP205 44
GNG13 44
GNG2 44
BRD4132 43
EIF4E 43
GNG10 43
LYN 43
NFKBIA 43
RPS6 43
MAP2K4 43
SLC2A1 43
TGFB3 43
TK2 43
YWHAE 43
WT-161 42
CDH1 42
AP2M1 42
DNM1 42
NOTCH2 42
ORC2 42
PIK3R2 42
POLR2H 42
YWHAZ 42
SPOP 42
RAD50 42
NUP188 42
PIKFYVE 42
DHFRP1 42
cyanoquinoline 11 41
PF-573228 41
MI-2 41
bexarotene 41
CDC25A 41
EPHA2 41
IL2RG 41
KIT 41
LRP1 41
SNAP25 41
STAT1 41
TSC1 41
TUBA3D 41
adenocarcinoma 40
nelarabine 40
sildenafil 40
AP2A1 40
CCND1 40
COL4A1 40
GNB3 40
HLA-DRB1 40
SMAD4 40
PRKAR1B 40
PSEN1 40
TNFRSF1A 40
RAE1 40
NUP93 40
VAC14 40
BRD-K04800985 39
BRD-K14844214 39
leucascandrolide A 39
BRD-K09587429 39
ADCY1 39
FOS 39
HSPA5 39
HSP90AA1 39
JAK3 39
KITLG 39
PPP2R1A 39
SELPLG 39
TOP2A 39
NUP214 39
CAY10576 38
RAF265 38
ACACA 38
CRK 38
EIF4A1 38
ITGAL 38
KPNA1 38
NCBP1 38
STAT5A 38
MAPKAPK2 38
AKAP9 38
ORC6 38
GNG12 38
nakiterpiosin 37
Compound 44 37
PD 153035 37
IU1 37
B2M 37
CASP7 37
CLTC 37
FN1 37
GSK3A 37
HDAC1 37
PLAT 37
AURKA 37
FBXW7 37
MCM8 37
SKNBE2 36
etomoxir 36
GANT-61 36
ARAF 36
BUB1B 36
CCND2 36
CDKN2B 36
FGF9 36
FOXO3 36
PRKAA1 36
PRKACA 36
RARA 36
RPS6KA3 36
RPS6KB1 36
TGFB2 36
HSP90B1 36
TTK 36
KAT2B 36
NUP155 36
PDE4DIP 36
BRIP1 36
RHPN2 36
ovary 35
diffuse large B-cell lymphoma 35
RO4929097 35
GMX1778 35
APEX1 35
CDKN1B 35
MYCL 35
NOTCH1 35
NOTCH4 35
PPIA 35
TGFBR1 35
TRIO 35
NCSTN 35
tozasertib 34
C2 34
CASP8 34
CD44 34
COL4A6 34
DUSP6 34
MECOM 34
LIMK1 34
SMAD3 34
MYH11 34
PDK3 34
RFC5 34
SYK 34
TLN1 34
KDM6A 34
DBF4 34
SMUG1 34
NUP62 34
LRRK2 34
APP 33
ESR1 33
P4HB 33
PXN 33
RET 33
STK4 33
KALRN 33
LATS1 33
PSIP1 33
SLC30A7 33
UMCHOR1 32
MI-1 32
dasatinib 32
nilotinib 32
PRIMA-1-Met 32
ARF1 32
CDKN1A 32
CSNK1A1 32
INSR 32
PI4KA 32
MAP2K5 32
RANBP2 32
RPA1 32
MAP3K7 32
NCOA1 32
BCAR1 32
PLBD1 32
LSM10 32
adrenal cortex carcinoma 31
ABT-751 31
manumycin A 31
XIAP 31
BCL2L1 31
CASP10 31
ERCC3 31
GNAQ 31
IRS1 31
LIG1 31
NUP88 31
SRSF2 31
RIPK1 31
FGF17 31
WASL 31
PLEKHA5 31
KMT2C 31
MUGCHOR1 30
vinorelbine 30
CIL41 30
hyperforin 30
IC-87114 30
BRD-K20514654 30
PRIMA-1 30
APC 30
HLA-DRA 30
MAP3K1 30
POLA1 30
MAPK7 30
RAB3A 30
ST6GAL1 30
SPTAN1 30
SYT1 30
UBE2D1 30
WAS 30
MAPKAPK3 30
HERC2 30
PLAAT3 30
CNTN6 30
POLR3GL 30
LSM11 30
AMOT 30
DCP2 30
lovastatin acid 29
CACNB2 29
FGF5 29
GRIN1 29
NRG1 29
ICAM1 29
LCK 29
SMAD2 29
MYLK 29
NOS3 29
ROR1 29
PIK3CD 29
POLR2K 29
PRKD1 29
TYK2 29
YWHAH 29
NCOA3 29
NUP58 29
NUP50 29
KAT6B 29
PRKAG2 29
PSENEN 29
RPTOR 29
NUP85 29
NUP43 29
rotenone 28
FQI-2 28
PRL-3 inhibitor I 28
CD-1530 28
sunitinib 28
ABT-199 28
ACVR2A 28
CDK5 28
FEN1 28
HIF1A 28
MUTYH 28
POLR2E 28
PSEN2 28
RAD1 28
ROBO2 28
ST3GAL1 28
STXBP1 28
SQSTM1 28
CLP1 28
TRIB3 28
SEH1L 28
NPHP4 28
HA1E-M 27
SUDHL6 27
JHC7 27
follicular lymphoma 27
ACACB 27
SLC25A6 27
C4A 27
CCNH 27
GATA2 27
GTF2F2 27
HEXB 27
ITK 27
LIG4 27
AFDN 27
MYH9 27
NF1 27
SERPINE1 27
PIK3C3 27
POLD1 27
PRKAA2 27
SMARCB1 27
HNF1A 27
RIPK2 27
MASP2 27
PLCB1 27
PRAME 27
ZNF473 27
UBR5 27
TLR9 27
CHD9 27
APH1B 27
MFSD2A 27
UCH1 26
BRD-K17060750 26
BRD-A94377914 26
NU7441 26
SZ4TA2 26
FAS 26
CAMK2D 26
E2F5 26
EDNRB 26
EIF4EBP1 26
FANCE 26
CFI 26
JARID2 26
NBN 26
NGFR 26
P2RY2 26
PPP2R1B 26
PRKCE 26
KDM5A 26
ROBO1 26
SP1 26
TGFB1 26
EZR 26
RUVBL2 26
MAP4K5 26
RASSF1 26
AMER1 26
RBBP4P1 26
PF-4800567 25
BRD-K99584050 25
BRD-K79669418 25
Ro-28-1675 25
importazole 25
SLC25A4 25
BCL9 25
CCNA2 25
COPA 25
CSNK1E 25
DACH1 25
ERBB4 25
FANCD2 25
FOXO1 25
HK1 25
HOXD13 25
IL7 25
ITGB3 25
MCM4 25
MDM2 25
POLB 25
POLR2F 25
PPP3CA 25
PRKAG1 25
PTCH1 25
RASGRF1 25
SLC2A4 25
ADAM17 25
TBXA2R 25
TCF12 25
CXCR4 25
AXIN2 25
CCNO 25
STK25 25
MALT1 25
SIK2 25
TBK1 25
HEK293T 24
paraganglionic neoplasm 24
BCL-LZH-4 24
DC-45-A2 24
AZ-3146 24
oligomycin A 24
ADRB2 24
SLC25A5 24
CFB 24
COL4A5 24
DNM2 24
E2F3 24
F10 24
GPC3 24
GNAI1 24
MSH6 24
HLA-A 24
HMGB2 24
TNFRSF9 24
NUMA1 24
P2RY6 24
PDCD1 24
PPP2R5D 24
MAPK10 24
STX1A 24
TLR4 24
TTN 24
VAV1 24
XDH 24
XK 24
XPO1 24
XRCC4 24
CUL1 24
SOCS3 24
ARPC2 24
TAB1 24
GNB5 24
WWTR1 24
CDK12 24
DLL4 24
SMURF1 24
SLC30A5 24
TUBB1 24
OBSCN 24
MUC16 24
TTL 24
MIR4728 24
CCACCAAATATTTGGAGGCTA 24
CGAAGAACTCAATGGAGAGAA 24
gastrointestinal neuroendocrin 23
ALK 23
ADGRB1 23
DFFB 23
DHFR 23
FHIT 23
GNAI2 23
HEXA 23
MCM2 23
MRE11 23
FURIN 23
EXOSC9 23
POLR2A 23
MAP2K6 23
PTPN11 23
RAN 23
RFC2 23
STAR 23
TNFRSF1B 23
TP53BP1 23
CLTCL1 23
PIK3R3 23
BTRC 23
ISG15 23
GNA13 23
CHL1 23
PAPOLA 23
TAB2 23
PPP2R3B 23
EXOSC4 23
NHP2 23
LIN37 23
CHD8 23
MIR582 23
GCCTGAGTTCAACGTCAGAAA 23
GAGTGGCAGTTCAACCACTTT 23
HSTS 22
brefeldin A 22
ISOX 22
MK-591 22
tigecycline 22
BIRC2 22
CDH3 22
VCAN 22
CSTF1 22
CTNNA1 22
CYP27A1 22
DAPK3 22
EEF2 22
F8 22
JUNB 22
MYT1 22
ROR2 22
DDR2 22
PPARA 22
PPP1CA 22
RBL2 22
RHEB 22
VAMP2 22
TCF3 22
TEK 22
XRCC5 22
YES1 22
CAMK1 22
BECN1 22
INPP4B 22
ULK2 22
EXOSC8 22
EXOSC2 22`;
function create_wordcloud(){/* totally 7 parameters to control the picture */
const max_word_number = 250;
const angle_count = 5; // default 5
const angle_from = -60; // default -60
const angle_to = 60; // default 60
const font_name = "Impact"; // default Impact
const scale_type = "sqrt"; // three options: log, sqrt, linear. default log. see https://i.stack.imgur.com/0oZZQ.png
const spiral_type = "archimedean"; // two options: archimedean, rectangular. default archimedean. see https://en.wikipedia.org/wiki/Archimedean_spiral

function read_word_frequency(whole_list) {
  let tags = {};
  whole_list.split(/\n/g).forEach(function (one_word) {
    const p = /(.+) (\d+$)/;
    const found = one_word.match(p);
    if (found) {
      tags[found[1]] = found[2];
    }
  }),
    tags = d3.entries(tags),
    generate(tags)
}
function generate(tags) {
  layout.font(font_name).spiral(spiral_type),
    fontSize = d3.scale[scale_type]().range([10, 70]),
    tags.length && fontSize.domain([+tags[tags.length - 1].value || 1, +tags[0].value]),
    complete = 0,
    words = [],
    layout.stop().words(tags.slice(0, max = Math.min(tags.length, max_word_number))).start()
}
function progress(t) {
  console.log('word ' + (++complete) + " out of " + max);
}

function draw(tags, bounds) {
  scale = bounds ? Math.min(w_cloud / Math.abs(bounds[1].x - w_cloud / 2), w_cloud / Math.abs(bounds[0].x - w_cloud / 2), h_cloud / Math.abs(bounds[1].y - h_cloud / 2), h_cloud / Math.abs(bounds[0].y - h_cloud / 2)) / 2 : 1,
    words = tags;
  var n = vis.selectAll("text").data(words, function (t) {
    return t.text.toLowerCase()
  });
  n.transition().duration(1e3).attr("transform", function (t) {
    return "translate(" + [t.x, t.y] + ")rotate(" + t.rotate + ")"
  }).style("font-size", function (t) {
    return t.size + "px"
  }),
    n.enter().append("text").attr("text-anchor", "middle").attr("transform", function (t) {
      return "translate(" + [t.x, t.y] + ")rotate(" + t.rotate + ")"
    }).style("font-size", "1px").transition().duration(1e3).style("font-size", function (t) {
      return t.size + "px"
    }),
    n.style("font-family", function (t) {
      return t.font
    }).style("fill", function (t) {
      return fill(t.text.toLowerCase())
    }).text(function (t) {
      return t.text
    });
    console.log("background="+background);
  var a = background.append("g").attr("transform", vis.attr("transform"))
    , r = a.node();
  n.exit().each(function () {
    r.appendChild(this)
  }),
    a.transition().duration(1e3).style("opacity", 1e-6).remove(),
    vis.transition().delay(1e3).duration(750).attr("transform", "translate(" + [w_cloud >> 1, h_cloud >> 1] + ")scale(" + scale + ")")
}

/* The code here is largely based on https://github.com/jasondavies/d3-cloud
The following part is mostly a copy of the source code index.js */
var dispatch = d3.dispatch;

var cloudRadians = Math.PI / 180,
  cw = 1 << 11 >> 5,
  ch = 1 << 11;

d3.layout.cloud = function () {
  var size = [256, 256],
    text = cloudText,
    font = cloudFont,
    fontSize = cloudFontSize,
    fontStyle = cloudFontNormal,
    fontWeight = cloudFontNormal,
    rotate = cloudRotate,
    padding = cloudPadding,
    spiral = archimedeanSpiral,
    words = [],
    timeInterval = Infinity,
    event = dispatch("word", "end"),
    timer = null,
    random = Math.random,
    cloud = {},
    canvas = cloudCanvas;

  cloud.canvas = function (_) {
    return arguments.length ? (canvas = functor(_), cloud) : canvas;
  };

  cloud.start = function () {
    var contextAndRatio = getContext(canvas()),
      board = zeroArray((size[0] >> 5) * size[1]),
      bounds = null,
      n = words.length,
      i = -1,
      tags = [],
      data = words.map(function (d, i) {
        d.text = text.call(this, d, i);
        d.font = font.call(this, d, i);
        d.style = fontStyle.call(this, d, i);
        d.weight = fontWeight.call(this, d, i);
        d.rotate = rotate.call(this, d, i);
        d.size = ~~fontSize.call(this, d, i);
        d.padding = padding.call(this, d, i);
        return d;
      }).sort(function (a, b) { return b.size - a.size; });

    if (timer) clearInterval(timer);
    timer = setInterval(step, 0);
    step();

    return cloud;

    function step() {
      var start = Date.now();
      while (Date.now() - start < timeInterval && ++i < n && timer) {
        var d = data[i];
        d.x = (size[0] * (random() + .5)) >> 1;
        d.y = (size[1] * (random() + .5)) >> 1;
        cloudSprite(contextAndRatio, d, data, i);
        if (d.hasText && place(board, d, bounds)) {
          tags.push(d);
          event.word(d);
          if (bounds) cloudBounds(bounds, d);
          else bounds = [{ x: d.x + d.x0, y: d.y + d.y0 }, { x: d.x + d.x1, y: d.y + d.y1 }];
          // Temporary hack
          d.x -= size[0] >> 1;
          d.y -= size[1] >> 1;
        }
      }
      if (i >= n) {
        cloud.stop();
        event.end(tags, bounds);
      }
    }
  }

  cloud.stop = function () {
    if (timer) {
      clearInterval(timer);
      timer = null;
    }
    return cloud;
  };

  function getContext(canvas) {
    canvas.width = canvas.height = 1;
    var ratio = Math.sqrt(canvas.getContext("2d").getImageData(0, 0, 1, 1).data.length >> 2);
    canvas.width = (cw << 5) / ratio;
    canvas.height = ch / ratio;

    var context = canvas.getContext("2d");
    context.fillStyle = context.strokeStyle = "red";
    context.textAlign = "center";

    return { context: context, ratio: ratio };
  }

  function place(board, tag, bounds) {
    var perimeter = [{ x: 0, y: 0 }, { x: size[0], y: size[1] }],
      startX = tag.x,
      startY = tag.y,
      maxDelta = Math.sqrt(size[0] * size[0] + size[1] * size[1]),
      s = spiral(size),
      dt = random() < .5 ? 1 : -1,
      t = -dt,
      dxdy,
      dx,
      dy;

    while (dxdy = s(t += dt)) {
      dx = ~~dxdy[0];
      dy = ~~dxdy[1];

      if (Math.min(Math.abs(dx), Math.abs(dy)) >= maxDelta) break;

      tag.x = startX + dx;
      tag.y = startY + dy;

      if (tag.x + tag.x0 < 0 || tag.y + tag.y0 < 0 ||
        tag.x + tag.x1 > size[0] || tag.y + tag.y1 > size[1]) continue;
      // TODO only check for collisions within current bounds.
      if (!bounds || !cloudCollide(tag, board, size[0])) {
        if (!bounds || collideRects(tag, bounds)) {
          var sprite = tag.sprite,
            w = tag.width >> 5,
            sw = size[0] >> 5,
            lx = tag.x - (w << 4),
            sx = lx & 0x7f,
            msx = 32 - sx,
            h = tag.y1 - tag.y0,
            x = (tag.y + tag.y0) * sw + (lx >> 5),
            last;
          for (var j = 0; j < h; j++) {
            last = 0;
            for (var i = 0; i <= w; i++) {
              board[x + i] |= (last << msx) | (i < w ? (last = sprite[j * w + i]) >>> sx : 0);
            }
            x += sw;
          }
          delete tag.sprite;
          return true;
        }
      }
    }
    return false;
  }

  cloud.timeInterval = function (_) {
    return arguments.length ? (timeInterval = _ == null ? Infinity : _, cloud) : timeInterval;
  };

  cloud.words = function (_) {
    return arguments.length ? (words = _, cloud) : words;
  };

  cloud.size = function (_) {
    return arguments.length ? (size = [+_[0], +_[1]], cloud) : size;
  };

  cloud.font = function (_) {
    return arguments.length ? (font = functor(_), cloud) : font;
  };

  cloud.fontStyle = function (_) {
    return arguments.length ? (fontStyle = functor(_), cloud) : fontStyle;
  };

  cloud.fontWeight = function (_) {
    return arguments.length ? (fontWeight = functor(_), cloud) : fontWeight;
  };

  cloud.rotate = function (_) {
    return arguments.length ? (rotate = functor(_), cloud) : rotate;
  };

  cloud.text = function (_) {
    return arguments.length ? (text = functor(_), cloud) : text;
  };

  cloud.spiral = function (_) {
    return arguments.length ? (spiral = spirals[_] || _, cloud) : spiral;
  };

  cloud.fontSize = function (_) {
    return arguments.length ? (fontSize = functor(_), cloud) : fontSize;
  };

  cloud.padding = function (_) {
    return arguments.length ? (padding = functor(_), cloud) : padding;
  };

  cloud.random = function (_) {
    return arguments.length ? (random = _, cloud) : random;
  };

  cloud.on = function () {
    var value = event.on.apply(event, arguments);
    return value === event ? cloud : value;
  };

  return cloud;
};

function cloudText(d) {
  return d.text;
}

function cloudFont() {
  return "serif";
}

function cloudFontNormal() {
  return "normal";
}

function cloudFontSize(d) {
  return Math.sqrt(d.value);
}

function cloudRotate() {
  return (~~(Math.random() * 6) - 3) * 30;
}

function cloudPadding() {
  return 2;
}

// Fetches a monochrome sprite bitmap for the specified text.
// Load in batches for speed.
function cloudSprite(contextAndRatio, d, data, di) {
  if (d.sprite) return;
  var c = contextAndRatio.context,
    ratio = contextAndRatio.ratio;

  c.clearRect(0, 0, (cw << 5) / ratio, ch / ratio);
  var x = 0,
    y = 0,
    maxh = 0,
    n = data.length;
  --di;
  while (++di < n) {
    d = data[di];
    c.save();
    c.font = d.style + " " + d.weight + " " + ~~((d.size + 1) / ratio) + "px " + d.font;
    var w = c.measureText(d.text + "m").width * ratio,
      h = d.size << 1;
    if (d.rotate) {
      var sr = Math.sin(d.rotate * cloudRadians),
        cr = Math.cos(d.rotate * cloudRadians),
        wcr = w * cr,
        wsr = w * sr,
        hcr = h * cr,
        hsr = h * sr;
      w = (Math.max(Math.abs(wcr + hsr), Math.abs(wcr - hsr)) + 0x1f) >> 5 << 5;
      h = ~~Math.max(Math.abs(wsr + hcr), Math.abs(wsr - hcr));
    } else {
      w = (w + 0x1f) >> 5 << 5;
    }
    if (h > maxh) maxh = h;
    if (x + w >= (cw << 5)) {
      x = 0;
      y += maxh;
      maxh = 0;
    }
    if (y + h >= ch) break;
    c.translate((x + (w >> 1)) / ratio, (y + (h >> 1)) / ratio);
    if (d.rotate) c.rotate(d.rotate * cloudRadians);
    c.fillText(d.text, 0, 0);
    if (d.padding) c.lineWidth = 3 * d.padding, c.strokeText(d.text, 0, 0);
    c.restore();
    d.width = w;
    d.height = h;
    d.xoff = x;
    d.yoff = y;
    d.x1 = w >> 1;
    d.y1 = h >> 1;
    d.x0 = -d.x1;
    d.y0 = -d.y1;
    d.hasText = true;
    x += w;
  }
  var pixels = c.getImageData(0, 0, (cw << 5) / ratio, ch / ratio).data,
    sprite = [];
  while (--di >= 0) {
    d = data[di];
    if (!d.hasText) continue;
    var w = d.width,
      w32 = w >> 5,
      h = d.y1 - d.y0;
    // Zero the buffer
    for (var i = 0; i < h * w32; i++) sprite[i] = 0;
    x = d.xoff;
    if (x == null) return;
    y = d.yoff;
    var seen = 0,
      seenRow = -1;
    for (var j = 0; j < h; j++) {
      for (var i = 0; i < w; i++) {
        var k = w32 * j + (i >> 5),
          m = pixels[((y + j) * (cw << 5) + (x + i)) << 2] ? 1 << (31 - (i % 32)) : 0;
        sprite[k] |= m;
        seen |= m;
      }
      if (seen) seenRow = j;
      else {
        d.y0++;
        h--;
        j--;
        y++;
      }
    }
    d.y1 = d.y0 + seenRow;
    d.sprite = sprite.slice(0, (d.y1 - d.y0) * w32);
  }
}

// Use mask-based collision detection.
function cloudCollide(tag, board, sw) {
  sw >>= 5;
  var sprite = tag.sprite,
    w = tag.width >> 5,
    lx = tag.x - (w << 4),
    sx = lx & 0x7f,
    msx = 32 - sx,
    h = tag.y1 - tag.y0,
    x = (tag.y + tag.y0) * sw + (lx >> 5),
    last;
  for (var j = 0; j < h; j++) {
    last = 0;
    for (var i = 0; i <= w; i++) {
      if (((last << msx) | (i < w ? (last = sprite[j * w + i]) >>> sx : 0))
        & board[x + i]) return true;
    }
    x += sw;
  }
  return false;
}

function cloudBounds(bounds, d) {
  var b0 = bounds[0],
    b1 = bounds[1];
  if (d.x + d.x0 < b0.x) b0.x = d.x + d.x0;
  if (d.y + d.y0 < b0.y) b0.y = d.y + d.y0;
  if (d.x + d.x1 > b1.x) b1.x = d.x + d.x1;
  if (d.y + d.y1 > b1.y) b1.y = d.y + d.y1;
}

function collideRects(a, b) {
  return a.x + a.x1 > b[0].x && a.x + a.x0 < b[1].x && a.y + a.y1 > b[0].y && a.y + a.y0 < b[1].y;
}

function archimedeanSpiral(size) {
  var e = size[0] / size[1];
  return function (t) {
    return [e * (t *= .1) * Math.cos(t), t * Math.sin(t)];
  };
}

function rectangularSpiral(size) {
  var dy = 4,
    dx = dy * size[0] / size[1],
    x = 0,
    y = 0;
  return function (t) {
    var sign = t < 0 ? -1 : 1;
    // See triangular numbers: T_n = n * (n + 1) / 2.
    switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
      case 0: x += dx; break;
      case 1: y += dy; break;
      case 2: x -= dx; break;
      default: y -= dy; break;
    }
    return [x, y];
  };
}

// TODO reuse arrays?
function zeroArray(n) {
  var a = [],
    i = -1;
  while (++i < n) a[i] = 0;
  return a;
}

function cloudCanvas() {
  return document.createElement("canvas");
}

function functor(d) {
  return typeof d === "function" ? d : function () { return d; };
}

var spirals = {
  archimedean: archimedeanSpiral,
  rectangular: rectangularSpiral
};

// following part is outside the original source code index.js
var words = [], max, scale = 0.5, complete = 0;
var fill = d3.scale.category20b(), w_cloud = 960, h_cloud = 600;
  layout = d3.layout.cloud().timeInterval(10).size([w_cloud, h_cloud]).fontSize(function (t) {
    return fontSize(+t.value)
  }).text(function (t) {
    return t.key
  }).on("word", progress).on("end", draw);
    svg = d3.select("#vis").append("svg").attr("width", w_cloud).attr("height", h_cloud);
    background = svg.append("g");
    console.log("background2="+background);

    vis = svg.append("g").attr("transform", "translate(" + [w_cloud >> 1, h_cloud >> 1] + ")");
      const c = angle_count;
      const hh = d3.scale.linear();
    hh.domain([0, c - 1]).range([angle_from, angle_to]);
    layout.rotate(function () {
      return hh(~~(Math.random() * c))
    });
    read_word_frequency(subject_frequency);
}
  